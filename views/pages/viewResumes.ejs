<!DOCTYPE html>
<html lang="en">
  <%- include('../shared/head') %>
  <%- include('../shared/signedInHeader.ejs') %>
  <body>
    <h1>My Resumes</h1>
    <div id="resumeList">
      <% if (resumes.length === 0) {%>
        <p>You have no resumes.</p>
      <% } else { %>
        <% for(let resume of resumes) { %>
          <div class="resume">
            <p><%= resume.title %></p>
            <a href="/resume-edit/<%= resume.id %>">Edit</a>
            <a href="/resume-view/<%= resume.id %>">View</a>
            <button class="share-btn">Share</button>
          </div>
        <% } %>
      <% } %>
    </div>

    <div id="shade">
      <div id="share-menu">
        <h1>Share</h1>
        <input type="text" name="share-txt" id="share-txt", placeholder="Add people">
      </div>
    </div>

    <script>
      const shareMenu = document.getElementById("share-menu");

      document.querySelectorAll(".share-btn").forEach(element => 
        element.addEventListener('click', async (e) => {
          const resumeClass = e.target.parentNode;
          const title = resumeClass.querySelector('p').innerHTML;

          shareMenu.querySelector("h1").innerHTML = `Share "${title}"`;
          shareMenu.parentNode.style.display = "flex";
        })
      );

      const exitShareMenu = function () {
        shareMenu.parentNode.style.display = "none";
      }

      // If shade is clicked, make hidden again
      shareMenu.parentNode.addEventListener('click', (e) => {
        if (e.target !== shareMenu.parentNode)
          return;
        exitShareMenu();
      })

      // If user presses escape, close menu
      document.addEventListener('keydown', (e) => {
        if (e.keyCode !== 27)
          return;
        exitShareMenu();
      })
    </script>

  </body>

</html>
